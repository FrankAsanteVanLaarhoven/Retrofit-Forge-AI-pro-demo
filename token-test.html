<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapbox Token Test</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.success { background: #059669; }
        .status.error { background: #dc2626; }
        .status.info { background: #3b82f6; }
        
        #mapContainer {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .token-info {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üó∫Ô∏è Mapbox Token Test</h1>
        
        <div class="test-section">
            <h3>Token Information</h3>
            <div class="token-info">
                <strong>Current Token:</strong><br>
                pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw
            </div>
            <div id="tokenStatus" class="status info">Testing token...</div>
        </div>
        
        <div class="test-section">
            <h3>Map Test</h3>
            <div id="mapStatus" class="status info">Initializing map...</div>
            <div id="mapContainer"></div>
        </div>
        
        <div class="test-section">
            <h3>Network Requests</h3>
            <div id="networkStatus" class="status info">Check Network tab for requests...</div>
            <p>Look for these requests in your browser's Network tab:</p>
            <ul>
                <li><code>style.json</code> - Should return 200</li>
                <li><code>sprite.png</code> - Should return 200</li>
                <li><code>glyphs.pbf</code> - Should return 200</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>Usage Limits</h3>
            <div class="status info">
                <strong>Free Tier Limits:</strong><br>
                ‚Ä¢ 50,000 map loads per month<br>
                ‚Ä¢ 100,000 geocoding requests per month<br>
                ‚Ä¢ After limits: $5 per 1,000 additional map loads
            </div>
        </div>
    </div>

    <script>
        const tokenStatus = document.getElementById('tokenStatus');
        const mapStatus = document.getElementById('mapStatus');
        const networkStatus = document.getElementById('networkStatus');
        
        // Test 1: Check if Mapbox GL JS is loaded
        if (typeof mapboxgl === 'undefined') {
            tokenStatus.className = 'status error';
            tokenStatus.textContent = '‚ùå Mapbox GL JS not loaded';
        } else {
            tokenStatus.className = 'status success';
            tokenStatus.textContent = '‚úÖ Mapbox GL JS loaded successfully';
        }
        
        // Test 2: Set and validate token
        const token = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
        mapboxgl.accessToken = token;
        
        if (mapboxgl.accessToken) {
            tokenStatus.className = 'status success';
            tokenStatus.textContent = '‚úÖ Token set successfully';
        } else {
            tokenStatus.className = 'status error';
            tokenStatus.textContent = '‚ùå Failed to set token';
        }
        
        // Test 3: Create map
        try {
            const map = new mapboxgl.Map({
                container: 'mapContainer',
                style: 'mapbox://styles/mapbox/light-v11',
                center: [-0.12, 51.51], // London
                zoom: 12,
                pitch: 60,
                bearing: -20
            });
            
            map.on('load', () => {
                mapStatus.className = 'status success';
                mapStatus.textContent = '‚úÖ Map loaded successfully! Token is working.';
                
                // Add a 3D building layer to test advanced features
                map.addLayer({
                    'id': '3d-buildings',
                    'source': 'composite',
                    'source-layer': 'building',
                    'filter': ['==', 'extrude', 'true'],
                    'type': 'fill-extrusion',
                    'minzoom': 15,
                    'paint': {
                        'fill-extrusion-color': '#aaa',
                        'fill-extrusion-height': ['get', 'height'],
                        'fill-extrusion-base': ['get', 'min_height'],
                        'fill-extrusion-opacity': 0.6
                    }
                });
            });
            
            map.on('error', (e) => {
                mapStatus.className = 'status error';
                mapStatus.textContent = `‚ùå Map error: ${e.error}`;
            });
            
        } catch (error) {
            mapStatus.className = 'status error';
            mapStatus.textContent = `‚ùå Failed to create map: ${error.message}`;
        }
        
        // Test 4: Monitor network requests
        setTimeout(() => {
            networkStatus.className = 'status info';
            networkStatus.textContent = 'üìä Check Network tab for style.json, sprite.png, glyphs.pbf requests. All should return 200 status.';
        }, 2000);
        
        // Test 5: Check for rate limiting
        setTimeout(() => {
            fetch('https://api.mapbox.com/styles/v1/mapbox/light-v11?access_token=' + token)
                .then(response => {
                    if (response.ok) {
                        console.log('‚úÖ Token has valid access to Mapbox API');
                    } else {
                        console.log('‚ö†Ô∏è Token may have restrictions:', response.status);
                    }
                })
                .catch(error => {
                    console.log('‚ö†Ô∏è Network error checking token:', error);
                });
        }, 3000);
    </script>
</body>
</html> 